# HTTP

## HTTPμ 4λ‹¨κ³„ μ²λ¦¬ λ‹¨κ³„

1. Connection: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ TCP μ»¤λ„¥μ…μ„ ν•μ„± (3-way handshake)
2. Request: ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— νΉμ • URLμ μμ›μ„ μ”μ²­ν•λ‹¤λ” λ©”μ‹μ§€λ¥Ό μ „μ†΅
3. Response: μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ— λ§λ” μ‘λ‹µ λ©”μ‹μ§€λ¥Ό μ „μ†΅
4. Close: ν΄λΌμ΄μ–ΈνΈλ‚ μ„λ²„ λ‘ μ¤‘ λ„κµ°κ°€κ°€ μ—°κ²°μ„ λμ

## π± HTTPμ λ°μ „ κ³Όμ •

### HTTP/1.1

ν• μμ μ”μ²­κ³Ό μ‘λ‹µμ— λ€ν•΄ ν•λ‚μ μ—°κ²°μ„ μ‚¬μ©ν•©λ‹λ‹¤. 

<img width="612" alt="image" src="https://user-images.githubusercontent.com/45311765/203532672-9beb3367-d214-4ca3-afd6-e7a2c6f650cc.png">

HTTP/1.1μ μ²­ν¬(chunk) μ „μ†΅μ„ μ΄μ©ν•λ©΄ λ°μ΄ν„° μ¤νΈλ¦¬λ°μ΄ κ°€λ¥ν•©λ‹λ‹¤. 

### [SPDY](https://ko.wikipedia.org/wiki/SPDY)

**μ›Ή μ½ν…μΈ λ¥Ό μ „μ†΅ν•  λ©μ **μΌλ΅ κµ¬κΈ€μ΄ κ°λ°ν• λΉ„ν‘μ¤€ κ°λ°©ν• λ„¤νΈμ›ν¬ ν”„λ΅ν† μ½μ…λ‹λ‹¤. SPDYλ” μ›Ή νμ΄μ§€μ λ΅λ”© μ‹κ°„μ„ μ¤„μ΄κΈ° μ„ν• λ©μ μΌλ΅ μ„¤κ³„λμ—μµλ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ SPDY ν΄λΌμ΄μ–ΈνΈλ” ν•λ‚μ μ†μΌ“ μ—°κ²°μ„ ν†µν•΄ νμ΄μ§€λ¥Ό κµ¬μ„±ν•λ” μ—¬λ¬κ°μ ν•μ„ μ”μ†λ¥Ό ν•κΊΌλ²μ— μ „μ†΅λ°›μ„ μ μλ„λ΅ λ§λ“¤μ–΄μ΅μµλ‹λ‹¤. λν• gzip λλ” deflate μ•κ³ λ¦¬μ¦μ„ ν™μ©ν•΄ ν—¤λ”λ¥Ό μ••μ¶•ν•΄μ„ μ „μ†΅ν•©λ‹λ‹¤. SPDY μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ κΈ°λ‹¤λ¦¬μ§€ μ•κ³ , νμ΄μ§€μ λ‚΄μ©μ΄ λ³€κ²½λμ—μμ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ•λ¦¬κ±°λ‚ μƒ λ³€κ²½ λ‚΄μ©μ„ μ§μ ‘ μ „μ†΅ν•  μ μμµλ‹λ‹¤. SPDYλ” λ°λ“μ‹ SSL λλ” TLSλ΅ μ•”νΈν™”λ ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤. 

HTTPλ” HTTPλ¥Ό λ€μ²΄ν•λ” ν”„λ΅ν† μ½μ΄ μ•„λ‹λΌ HTTPκ°€ μ „μ†΅ κ³„μΈµμ„ ν†µν•΄ μ „μ†΅λλ” λ°©μ‹μ„ μ¬μ •μν•λ” ν”„λ΅ν† μ½μ…λ‹λ‹¤. SPDYλ” HTTP 2.0μ μ΄μ•μ΄ λμ—μµλ‹λ‹¤. 

### TLS(Transmission Control Protocol)

μΌλ°μ μΈ TCPλ¥Ό μ‚¬μ©ν•λ” κ²½μ° ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” 1 RTTμΈ TCP 3-way ν•Έλ“μ…°μ΄ν‚Ήμ„ μν–‰ν• λ’¤ μ¦‰μ‹ μ–΄ν”λ¦¬μΌ€μ΄μ… λ°μ΄ν„°λ¥Ό μ „μ†΅ν•©λ‹λ‹¤. μ΄λ• TLSλ” TCPμ—μ„ μ‘λ™ν•κΈ° λ•λ¬Έμ— λ¨Όμ € TCP ν•Έλ“μ…°μ΄ν‚Ήμ„ μν–‰ν•κ³  μ•”νΈν™” νλΌλ―Έν„°λ¥Ό ν‘μƒν•κΈ° μ„ν•΄ μ¶”κ°€μ μΌλ΅ TLS ν•Έλ“μ…°μ΄ν‚Ήμ„ μν–‰ν•©λ‹λ‹¤. λ”°λΌμ„ μ¶”κ°€λ΅ 2 RTTλ¥Ό λ” μ†λΉ„ν•κ² λΌ λ„¤νΈμ›ν¬ μ†λ„κ°€ λλ ¤μ§€κ² λ©λ‹λ‹¤. νΉν λ¨λ°”μΌ ν™κ²½μ—μ„λ” μ—°κ²°μ΄ λκΈ°κ±°λ‚ λ‹¤μ‹ μ—°κ²°λλ” κ²½μ°κ°€ λ§¤μ° λ§κΈ° λ•λ¬Έμ— μƒν™©μ΄ μ•…ν™”λ  μ μμµλ‹λ‹¤. 

> [RTT(Round Trip Time, μ™•λ³µ μ‹κ°„)](https://en.wikipedia.org/wiki/Round-trip_delay)λ” ν¨ν‚·μ΄ λ©μ μ§€μ— λ„λ‹¬ν•κ³  λ‚μ„ ν•΄λ‹Ή ν¨ν‚·μ— λ€ν• μ‘λ‹µμ΄ μ¶λ°μ§€λ΅ λ‹¤μ‹ λμ•„μ¤κΈ°κΉμ§€μ μ‹κ°„, μ¦‰ `ν¨ν‚· μ™•λ³µ μ‹κ°„`μ„ μλ―Έν•©λ‹λ‹¤. λ„¤νΈμ›ν¬ μ„±λ¥μ„ μΈ΅μ •ν•  λ•, RTTλ” λ„¤νΈμ›ν¬ μ—°κ²°μ μ†λ„μ™€ μ•μ •μ„±μ„ μ§„λ‹¨ν•λ” μ§€ν‘λ΅ μ‚¬μ©λ©λ‹λ‹¤. 

μ„μ λ‚΄μ©μ€ TLS 1.2μ— λ€ν• λ‚΄μ©μ΄μ—κ³ , TLS 1.3μ—μ„λ” λ” λ‚μ€ ν•Έλ“μ…°μ΄ν‚Ή λ©”μ»¤λ‹μ¦μ„ λ„μ…ν•΄ ν‘μƒ κ³Όμ •μ„ 1 RTTλ΅ μ¤„μ€μµλ‹λ‹¤. μΌλ¶€ μ„¤μ •μ—μ„λ” 0 RTT ν•Έλ“μ…°μ΄ν‚Ήμ„ μ κ³µν•΄ ν‘μƒ μ¤‘μ— μ–΄ν”λ¦¬μΌ€μ΄μ… λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό μλ„ μλ‹¤κ³  ν•©λ‹λ‹¤. 

μ΄λ ‡κ² TLS 1.3μ„ μ‚¬μ©ν•λ©΄ μ†λ„ λ¬Έμ κ°€ κ°μ„ λμ§€λ§ TLS 1.2λ¥Ό μ‚¬μ©ν•λ©΄μ„λ„ ν„μƒ κ³Όμ •μ„ 1 RTTλ΅ μ¤„μΌμλ” μ—†μ„κΉμ”? ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— λ‹¤μ‹ μ—°κ²°μ„ μ‹λ„ν•  λ• μ²«λ²μ§Έ μ—°κ²°μ—μ„ μ‚¬μ©ν• μ•”νΈν™” νλΌλ―Έν„°λ¥Ό μ¬μ‚¬μ©ν•λ‹¤λ©΄, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ•”νΈν™” νλΌλ―Έν„°μ™€ κ°™μ€ μ„Έμ… μ •λ³΄λ¥Ό κΈ°μ–µν•κ³  μ¬μ‚¬μ©ν•κΈ°λ΅ λ™μν•λ‹¤λ©΄, ν‘μƒ RTTλ¥Ό μ¤„μΌ μ μμ„ κ²ƒμ…λ‹λ‹¤. μ΄λ¥Ό `μ„Έμ… μ¬κ°(session resumption)`μ΄λΌκ³  ν•©λ‹λ‹¤. TLS 1.2μ μ„Έμ… IDμ™€ TLS μµμ¤ν…μ…μ μ„Έμ… ν‹°μΌ“μ„ ν™μ©ν•΄ κµ¬ν„ν•  μ μμµλ‹λ‹¤. 

`μ„Έμ… ID`  
μ„Έμ… IDλ¥Ό ν™•μ•ν•΄ μ΄μ „ μ”μ²­μ΄ μμ—λ”μ§€ ν™•μΈν•κ³  μ•”νΈν™” νλΌλ―Έν„°λ¥Ό μ¬μ‚¬μ©ν•  μ μμµλ‹λ‹¤. μ΄λ• μ„Έμ… IDλ¥Ό μ €μ¥ν•΄μ•Όν•λ”λ°, λ¨λ“  μ„λ²„ μΈμ¤ν„΄μ¤κ°€ κ³µμ ν•λ” μ„Έμ… μ¤ν† λ¦¬μ§€(Redis λ“±)λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤. π‘‰ μ¤ν…μ΄νΈν’€(stateful)

`μ„Έμ… ν‹°μΌ“`  
μ„Έμ… ν‹°μΌ“μ€ μ„Έμ… IDμ™€ λ‹¤λ¥΄κ² μ¤ν…μ΄νΈλ¦¬μ¤(stateless) μ„Έμ… μ¬κ°μ…λ‹λ‹¤. μ„Έμ…μ„ μ„λ²„μ— μ €μ¥ν•μ§€ μ•κ³  ν‹°μΌ“μ΄λΌκ³  λ¶€λ¥΄λ” μ„Έμ… λ°μ΄ν„°λ¥Ό μƒμ„±ν•΄μ„ μ΄ ν‹°μΌ“μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ¦¬ν„΄ν•©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— λ‹¤μ‹ μ—°κ²°μ„ μ‹λ„ν•  λ• κ°€μ§€κ³  μλ ν‹°μΌ“μ„ ν•¨κ» μ „μ†΅ν•©λ‹λ‹¤. μ„λ²„λ” κ°€μ§€κ³  μλ” λΉ„λ°€ν‚¤λ΅ ν‹°μΌ“μ„ λ³µνΈν™”ν•΄μ„ μ„Έμ… μ •λ³΄λ¥Ό ν™•μΈν•©λ‹λ‹¤. λ§μ•½ ν‹°μΌ“μ΄ λ§λ£λλ©΄ μ „μ²΄ TLS ν•Έλ“μ…°μ΄ν‚Ήμ„ λ‹¤μ‹ μν–‰ν•΄μ•Όν•©λ‹λ‹¤. 

### HTTP/2

HTTP/2μ—μ„λ” SPDYμ™€ μ μ‚¬ν•κ² ν—¤λ” μ••μ¶•μ„ μ§€μ›ν•λ©° λ” ν¨μ¨μ μΈ HPACK μ•κ³ λ¦¬μ¦μ„ ν™μ©ν•©λ‹λ‹¤. HTTP/2μ—μ„λ” λ©”μ‹μ§€ λ³Έλ¬Έμ΄ μ—¬λ¬ λ°μ΄ν„° ν”„λ μ„μΌλ΅ λ‚λ‰μ–΄ κ°κ° λ‹¤λ¥Έ μ¤νΈλ¦ΌμΌλ΅ μ „μ†΅λ©λ‹λ‹¤.  

HTTP/2μ—μ„λ” ν•λ‚μ μ—°κ²°μ„ μ—¬λ¬ μ¤νΈλ¦ΌμΌλ΅ λ‹¤μ¤‘ν™”ν•κΈ° λ•λ¬Έμ— μ‰½κ² μ¤νΈλ¦¬λ°μ„ μ§€μ›ν•  μ μμµλ‹λ‹¤. 

> `λ„¤νΈμ›ν¬ μ¶”μƒν™” κ³„μΈµ(Network Abstract Layer)`μ„ λ„μ…ν•΄ ν”„λ΅ν† μ½μ„ μ§μ ‘ κ³ λ¥΄λ” κ²ƒμ΄ μ•„λ‹λΌ μ–΄λ–¤ ν”„λ΅ν† μ½μ„ μ‚¬μ©ν• μ§€ μ–΄λ–¤ ν”„λ΅ν† μ½λ΅ μ²λ¦¬ν• μ§€λ¥Ό μμ¨μ μΌλ΅ μ„¤μ •ν•  μ μμµλ‹λ‹¤. μ΄λ ‡κ² μ–΄λ–¤ ν”„λ΅ν† μ½λ΅ μ²λ¦¬ν• μ§€μ— λ€ν• ν΄λΌμ΄μ–ΈνΈ μ„¤μ •μ€ `Connection Info`λ¥Ό μ‚¬μ©ν•΄ μ„¤μ •ν•  μ μμµλ‹λ‹¤. LINEμ—μ„λ” Connection Infoλ¥Ό μ΄μ©ν•΄ ν΄λΌμ΄μ–ΈνΈμ κµ­κ°€λ³„λ΅, μ‚¬μ© λ„¤νΈμ›ν¬(WIFI, λ¨λ°”μΌ λ“±) λ³„λ΅ μ„¤μ •μ„ λ‹¤λ¥΄κ² μ μ–΄ν•κ³  μλ‹¤κ³  ν•©λ‹λ‹¤. 

### QUIC

## μ°Έκ³  μλ£

- [LINT: HTTP/2μ™€ TLSλ¥Ό ν†µν• λ„¤νΈμ›ν¬ ν„λ€ν™” by LINE μ΄λ²½μ‚°](https://engineering.linecorp.com/ko/blog/LINT-newtork-modernization-http2-tls/)
